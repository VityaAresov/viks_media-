<%
  const f = typeof filters === 'object' && filters ? filters : { category: '', tag: '', q: '' };
  const currentTag = selectedTag && selectedTag.slug ? selectedTag.slug : '';
  const path = typeof activePath === 'string' ? activePath : '';
%>
<aside class="rail-left">
  <div class="rail-block">
    <a class="nav-pill <%= path === '/' && !f.category && !f.tag && !f.q ? 'is-active' : '' %>" href="/">
      <span class="nav-icon">&#x1F525;</span>
      <span>Popular</span>
    </a>
    <a class="nav-pill <%= !f.category && !f.tag && f.q ? 'is-active' : '' %>" href="/search?q=<%= encodeURIComponent(query || '') %>">
      <span class="nav-icon">&#x23F2;</span>
      <span>Fresh</span>
    </a>
    <a class="nav-pill <%= path === '/bookmarks' ? 'is-active' : '' %>" href="<%= currentUser ? '/bookmarks' : '/login' %>">
      <span class="nav-icon">&#x1F4CC;</span>
      <span>My feed</span>
    </a>
    <a class="nav-pill <%= path === '/account' ? 'is-active' : '' %>" href="<%= currentUser ? '/account' : '/login' %>">
      <span class="nav-icon">&#x1F464;</span>
      <span>Profile</span>
    </a>
    <a class="nav-pill <%= path === '/moderation/queue' ? 'is-active' : '' %>" href="<%= canModerate ? '/moderation/queue' : '/account' %>">
      <span class="nav-icon">&#x1F4CA;</span>
      <span>Rating</span>
    </a>
    <a class="nav-pill" href="<%= currentUser ? '/notifications' : '/login' %>">
      <span class="nav-icon">&#x1F4AC;</span>
      <span>Messages</span>
    </a>
  </div>

  <div class="rail-section">
    <h4>Topics</h4>
    <div class="topic-list">
      <% for (const category of categories) { %>
      <a
        class="topic-row <%= f.category === category.slug ? 'is-active' : '' %>"
        href="/?<%= new URLSearchParams({ category: category.slug, tag: f.tag || '', q: f.q || '' }).toString() %>"
      >
        <span class="topic-avatar"><%= category.name.slice(0, 1).toUpperCase() %></span>
        <span><%= category.name %></span>
      </a>
      <% } %>
    </div>
  </div>

  <div class="rail-section">
    <h4>Tags</h4>
    <div class="tag-cloud">
      <% for (const tag of popularTags.slice(0, 9)) { %>
      <a
        class="tag-chip <%= currentTag === tag.slug || f.tag === tag.slug ? 'is-active' : '' %>"
        href="/?<%= new URLSearchParams({ category: f.category || '', tag: tag.slug, q: f.q || '' }).toString() %>"
      >
        #<%= tag.slug %>
      </a>
      <% } %>
    </div>
  </div>
</aside>
